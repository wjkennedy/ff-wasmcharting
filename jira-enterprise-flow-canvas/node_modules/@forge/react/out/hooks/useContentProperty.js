"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useContentProperty = void 0;
const react_1 = require("react");
const bridge_1 = require("@forge/bridge");
const confluenceEntity_1 = require("./confluenceEntity");
const useEntityProperty_1 = require("./useEntityProperty");
/**
 * This function manages the content properties of a Confluence page where the app is installed.
 * @param propertyKey Name (key) of the property
 * @param initValue Default value if it did not exist previously
 * @returns An array with 3 items:
 *  1. Current value of the property.
 *  2. A function to update the property value (with another value or an updater function). If an initial update fails, it automatically tries to update for another <retryCount> times (default 2).
 *  3. A function to delete the property.
 */
const useContentProperty = (propertyKey, initValue) => {
    const entityManager = (0, react_1.useMemo)(() => (0, confluenceEntity_1.confluenceEntity)({
        entityType: 'Content',
        origPropertyKey: propertyKey,
        initValue
    }), [propertyKey, initValue]);
    const [propValue, updateProp, deleteProp] = (0, useEntityProperty_1.useEntityProperty)({ entityManager });
    const updatePropWithEvent = (0, react_1.useCallback)(async (valueUpdate, retryCount) => {
        const success = await updateProp(valueUpdate, retryCount);
        if (success) {
            void bridge_1.events.emit('FORGE_CONTENT_PROPERTY_UPDATED', { propertyKey, valueUpdate });
        }
    }, [updateProp, propertyKey]);
    return [propValue, updatePropWithEvent, deleteProp];
};
exports.useContentProperty = useContentProperty;
