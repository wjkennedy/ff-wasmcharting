"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.events = void 0;
const bridge_1 = require("../bridge");
const serialiseBlob_1 = require("./serialiseBlob");
const callBridge = (0, bridge_1.getCallBridge)();
const wrapCallback = (callback) => {
    return (payload) => {
        let newPayload = payload;
        if ((0, serialiseBlob_1.containsSerialisedBlobs)(payload)) {
            newPayload = (0, serialiseBlob_1.deserialiseBlobsInPayload)(payload);
        }
        return callback(newPayload);
    };
};
const emit = async (event, payload) => {
    let newPayload = payload;
    if ((0, serialiseBlob_1.containsBlobs)(payload)) {
        newPayload = await (0, serialiseBlob_1.serialiseBlobsInPayload)(payload);
    }
    return callBridge('emit', { event, payload: newPayload });
};
const on = (event, callback) => {
    return callBridge('on', { event, callback: wrapCallback(callback) });
};
const emitPublic = async (event, payload) => {
    let newPayload = payload;
    if ((0, serialiseBlob_1.containsBlobs)(payload)) {
        newPayload = await (0, serialiseBlob_1.serialiseBlobsInPayload)(payload);
    }
    return callBridge('emitPublic', { event, payload: newPayload });
};
const onPublic = (event, callback) => {
    return callBridge('onPublic', { event, callback: wrapCallback(callback) });
};
exports.events = {
    emit,
    on,
    emitPublic,
    onPublic
};
