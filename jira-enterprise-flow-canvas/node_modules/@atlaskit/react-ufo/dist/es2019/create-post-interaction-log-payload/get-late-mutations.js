function getLateMutations(vcDetails, labelStacks = {}, lastInteractionFinish, postInteractionFinishVCRatios) {
  // Map to track which elements are already seen for each timestamp
  const seen = new Map();
  const result = [];
  for (const part in vcDetails) {
    const details = vcDetails[part];
    if (!(details !== null && details !== void 0 && details.t) || details.t <= lastInteractionFinish.end || !details.e) {
      continue; // Skip if not late or no elements
    }
    if (!seen.has(details.t)) {
      seen.set(details.t, new Set());
    }
    const seenElements = seen.get(details.t);
    for (const element of details.e) {
      if (seenElements.has(element)) {
        continue;
      }
      seenElements.add(element);
      const lateMutation = {
        time: details.t,
        element,
        viewportHeatmapPercentage: (postInteractionFinishVCRatios === null || postInteractionFinishVCRatios === void 0 ? void 0 : postInteractionFinishVCRatios[element]) || 0
      };
      if (labelStacks) {
        const labels = labelStacks[element];
        if (labels && typeof labels !== 'string') {
          lateMutation.segment = labels.segment;
          lateMutation.labelStack = labels.labelStack;
        }
      }
      result.push(lateMutation);
    }
  }
  return result;
}
export default getLateMutations;